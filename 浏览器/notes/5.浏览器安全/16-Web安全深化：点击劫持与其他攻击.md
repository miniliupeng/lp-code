# 16-Web安全深化：点击劫持与其他攻击

除了 XSS 和 CSRF，Web 世界还面临着多种其他的安全威胁。了解这些攻击的原理，有助于我们构建更健壮、更具韧性的应用程序。

## 1. 点击劫持 (Clickjacking)

*   **核心原理**：点击劫持是一种**视觉欺骗**攻击。攻击者创建一个看似无害的网页，然后使用一个**透明的、覆盖在页面上层的 `<iframe>`** 来加载一个目标网站。攻击者会精心设计UI，诱导用户点击页面上的某个按钮或链接（例如“领取奖励”），而用户实际上点击的是被透明 `<iframe>` 覆盖的目标网站上的某个危险操作按钮（例如“删除账户”、“确认转账”）。
*   **攻击目标**：在用户不知情的情况下，欺骗用户执行非本意的操作。
*   **本质**：利用了 `<iframe>` 的能力和 UI 视觉欺骗。

### 防御策略

防御的核心思想是**控制我们的网站是否可以被嵌入到 `<iframe>` 中**。

1.  **X-Frame-Options 响应头**
    *   这是一个专门用于防御点击劫持的 HTTP 响应头。
    *   **配置选项**：
        *   `DENY`: 完全禁止任何页面通过 `<iframe>` 嵌入。
        *   `SAMEORIGIN`: 只允许来自同源的页面嵌入。
    *   这是最直接、兼容性最好的防御手段。

2.  **CSP 的 `frame-ancestors` 指令**
    *   这是 `X-Frame-Options` 的现代化替代方案，功能更强大。它作为 `Content-Security-Policy` 头部的一部分。
    *   **配置示例**：
        *   `Content-Security-Policy: frame-ancestors 'none';`: 效果等同于 `X-Frame-Options: DENY`。
        *   `Content-Security-Policy: frame-ancestors 'self';`: 效果等同于 `X-Frame-Options: SAMEORIGIN`。
        *   `Content-Security-Policy: frame-ancestors 'self' https://partner.com;`: 允许同源页面和指定的合作伙伴网站嵌入。
    *   如果同时存在，`frame-ancestors` 的优先级高于 `X-Frame-Options`。

## 2. 中间人攻击 (Man-in-the-Middle Attack, MITM)

*   **核心原理**：攻击者将自己置于**客户端和服务器之间**，伪装成通信的双方，从而能够**窃听、篡改甚至完全控制**两者之间的通信内容。
*   **攻击场景**：常发生在不安全的公共 Wi-Fi 环境下。
*   **攻击流程**：
    1.  攻击者在网络中拦截客户端发往服务器的请求。
    2.  攻击者伪装成服务器，与客户端建立连接。
    3.  同时，攻击者伪装成客户端，与真实的服务器建立连接。
    4.  对于客户端来说，它认为自己在和服务器通信；对于服务器来说，它认为自己在和客户端通信。而实际上，所有的通信内容都被中间的攻击者过了一遍。

### 防御策略

防御的核心思想是**加密通信链路**，让中间人即使截获了数据，也无法解密其内容。

1.  **全站启用 HTTPS (核心)**
    *   HTTPS 通过 SSL/TLS 协议对通信内容进行加密，并验证服务器的身份。这是**防御中间人攻击最根本、最有效**的手段。只要用户访问的是 `https://` 开头的网址，并且证书有效，中间人就无法解密传输的数据。

2.  **HSTS (HTTP Strict Transport Security)**
    *   我们在 `15-HTTP安全头部详解.md` 中提到，HSTS 可以防止 **SSL 剥离攻击**。SSL 剥离是中间人攻击的一种，攻击者拦截客户端的 HTTPS 请求，然后自己用 HTTP 去请求服务器，从而将安全的 HTTPS 连接降级为不安全的 HTTP 连接。HSTS 可以强制浏览器只能使用 HTTPS，杜绝了这种降级可能。

## 3. SQL 注入 (SQL Injection)

*   **核心原理**：这是一种**后端**安全漏洞。攻击者通过在前端提交的表单数据或 URL 参数中，**注入恶意的 SQL 命令**，欺骗服务器执行非预期的数据库操作。
*   **攻击目标**：窃取数据库中的敏感信息、篡改数据、甚至获取数据库服务器的控制权。
*   **前端为何需要了解**：虽然是后端漏洞，但前端需要意识到，任何发送到后端的用户输入都可能是不可信的，并配合后端进行防御。

### 防御策略（主要在后端）

1.  **参数化查询 / 预编译语句 (核心)**
    *   永远不要直接将用户输入拼接到 SQL 查询语句中。应使用数据库驱动提供的参数化查询接口，将用户输入作为**参数**传递，而不是作为**命令**的一部分。
2.  **输入验证与过滤**：对用户输入的数据类型、长度、格式进行严格的校验。
3.  **最小权限原则**：数据库用户应只被授予其业务所必需的最小权限。

## 4. DDoS (Distributed Denial-of-Service) - 分布式拒绝服务攻击

*   **核心原理**：攻击者控制大量的“僵尸”计算机（组成一个“僵尸网络”），在同一时间向目标服务器发起海量的、看似合法的请求，从而耗尽服务器的带宽、CPU、内存等资源，使其无法响应正常用户的请求，导致网站瘫痪。
*   **攻击目标**：让目标服务不可用。

### 防御策略

DDoS 防御是一个系统性工程，通常不是应用层面能完全解决的，需要依赖专业的基础设施和第三方服务。
1.  **使用专业的 CDN 服务**：CDN 的边缘节点可以吸收和过滤大量的恶意流量，是防御 DDoS 的第一道防线。
2.  **流量清洗服务**：专业的云服务商提供流量清洗服务，可以识别并拦截 DDoS 攻击流量。
3.  **负载均衡**：通过负载均衡将流量分发到多个服务器，避免单点故障。
4.  **服务器端限流**：对单个 IP 的请求频率进行限制。
